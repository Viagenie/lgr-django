{% extends "_base.html" %}
{% load i18n %}

{% block content %}
    <form class="form-horizontal" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {% include "lgr_editor/_form_field.html" with field=form.file %}
        {% include "lgr_editor/_form_field.html" with field=form.validating_repertoire %}
        <div id="zone_box">
            {% include "lgr_editor/_form_field.html" with field=form.zone_labels %}
            {% include "lgr_editor/_form_field.html" with field=form.set_name %}
        </div>
        <div id="zone_error">
            {% if form.errors %}
                {% for field in form %}
                    {% for error in field.errors %}
                        <div class="alert alert-danger">
                            <strong>{{ error|escape }}</strong>
                        </div>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        {% if lgrs %}
            <strong>{% trans "These LGRs are already imported. Click on one to access it." %}</strong>
            <ul>
                {% for lgr in lgrs %}
                    <li>
                        <a href="{% url 'codepoint_list' lgr.name %}">{% blocktrans with lgr_name=lgr.name %}{{ lgr_name }}{% endblocktrans %}</a>
                    </li>
                {% endfor %}
            </ul>
            <br>
        {% endif %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        <div class="text-right">
            <button type="submit" class="btn btn-primary">{% trans "Import" %}</button>
        </div>
    </form>

    <p>
        {% blocktrans trimmed %}
            <strong class="text-danger"><i class="glyphicon glyphicon-alert"></i> Note that importing large LGR files may take significant time to load on your browser.</strong>
        {% endblocktrans %}
    </p>
{% endblock content %}

{% block html_body_more %}
    {{ block.super }}
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            function check_multi_files() {
                var files = $('#id_file').prop('files');
                if(files.length > 1) {
                    $('#zone_box').show();
                    $("#id_zone_labels").prop('required', true);
                    $("#id_set_name").prop('required', true);
                } else {
                    $('#zone_box').hide();
                    $("#id_zone_labels").prop('required', false);
                    $("#id_set_name").prop('required', false);
                }
            }
            $('#id_file').change(function(){check_multi_files()});
            $('#id_file').show(function(){check_multi_files()});
            $('#id_file').click(function(){$('#zone_error').hide()});
        });
    </script>
{% endblock html_body_more %}